<?xml version="1.0" encoding="utf-8" standalone="no"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<PropertyGroup>
		<StartAction>Program</StartAction>
		<StartProgram>$(MSBuildProgramFiles32)\Microsoft Visual Studio $(VisualStudioVersion)\Common7\IDE\devenv.exe</StartProgram>
		<StartArguments>/rootsuffix exp</StartArguments>

		<NoGlobalAssemblyInfo>true</NoGlobalAssemblyInfo>
	</PropertyGroup>

	<Target Name="GetVersion" DependsOnTargets="GitVersion" Returns="$(Version)">
		<PropertyGroup>
			<Version Condition=" '$(Configuration)' == 'Release' ">$(GitSemVerMajor).$(GitSemVerMinor).$(GitSemVerPatch)</Version>
			<Version Condition=" '$(Configuration)' != 'Release' ">1.0.0</Version>
		</PropertyGroup>
	</Target>

	<Target Name="CopyVsixToOut" AfterTargets="CreateVsixContainer" DependsOnTargets="GetVersion" Condition="'$(Out)' != ''">
		<ItemGroup>
			<TargetVsixContainer Include="$(TargetVsixContainer)" />
		</ItemGroup>
		<!-- Copy the evergreen filename -->
		<Copy SourceFiles="@(TargetVsixContainer)" DestinationFolder="$(Out)" />
		<!-- And also a versioned filename -->
		<Copy SourceFiles="@(TargetVsixContainer)" DestinationFiles="$(Out)\%(TargetVsixContainer.Filename).$(Version)%(TargetVsixContainer.Extension)" />
	</Target>

	<!-- Because envdte comes from a nuget package, we can't set the EmbedInteropTypes to true in the project, so we do it here -->
	<Target Name="EmbedInteropTypes" AfterTargets="ResolveNuGetPackageAssets">
		<ItemGroup>
			<Reference Condition=" '%(Filename)' == 'envdte80' ">
				<EmbedInteropTypes>True</EmbedInteropTypes>
			</Reference>
		</ItemGroup>
	</Target>
</Project>